version: '3.8'
services:
  distrybute:
    image: ghcr.io/mmichaelb/distrybute:latest@sha256:ec85265adf861e5a96b36320b8c4630c5fbdba5e88b02096980c0d62bc29d800
    restart: unless-stopped
    ports:
      - "127.0.0.1:10711:10711"
    environment:
      DISTRYBUTE_LOG_FILE: /var/log/distrybute/log.json
      DISTRYBUTE_MINIO_ENDPOINT: minio:9000
      DISTRYBUTE_MINIO_ID: distrybute
      DISTRYBUTE_MINIO_SECRET: distrybute
      DISTRYBUTE_MINIO_BUCKET: distrybute
      DISTRYBUTE_POSTGRES_USER: distrybute
      DISTRYBUTE_POSTGRES_PASSWORD: distrybute
      DISTRYBUTE_POSTGRES_HOST: postgres
      DISTRYBUTE_POSTGRES_DB: distrybute
    volumes:
      - ./log:/var/log/distrybute/
    networks:
      - distrybute_compose
  postgres:
    image: postgres:15@sha256:7c0ee16b6a3b4403957ece2c186ff05c57097a557403ae5216ef1286e47c249c
    restart: unless-stopped
    environment:
      POSTGRES_PASSWORD: distrybute
      POSTGRES_USER: distrybute
      POSTGRES_DB: distrybute
    ports:
      - "127.0.0.1:5432:5432"
    volumes:
      - ./postgres:/var/lib/postgresql
    networks:
      - distrybute_compose
  minio:
    image: minio/minio:latest@sha256:2ff9b6a0705b28ce7bbfb1b09f4e2c4fb9c1832d7f1f147897b8cc4fa0064a96
    command: server /data
    restart: unless-stopped
    environment:
      MINIO_BROWSER: off
      MINIO_ROOT_USER: distrybute
      MINIO_ROOT_PASSWORD: distrybute
    volumes:
      - ./minio:/data
    networks:
      - distrybute_compose
networks:
  distrybute_compose:
